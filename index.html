<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéπ Arandy üé∂</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app-container">
        <header>
            <h1>üéπ Arandy üé∂</h1>
        </header>

        <fieldset id="appActionsFieldset">
            <div class="app-actions-bar">
                <div class="action-group file-actions">
                    <button id="restoreDefaultsButton" title="Create a new song (resets settings)">üìÑ New</button>
                    <button id="loadSettingsButton" title="Load song settings from a file">üìÅ Load</button>
                    <input type="file" id="loadSettingsFile" accept=".json" style="display: none;">
                    <button id="saveSettingsButton" title="Save current song settings">üíæ Save</button>
                </div>
            </div>
        </fieldset>

        <main class="main-content">
            <section class="input-section">
                <fieldset id="mainControlsFieldset">
                    <h2>‚úèÔ∏è Input</h2>
                    <div class="input-mode-selector">
                        <label><input type="radio" name="inputMode" value="chords" checked> üéµ Chord Names</label>
                        <label><input type="radio" name="inputMode" value="degrees"> üéº Scale Degrees</label>
                    </div>

                    <div id="chordNameInputArea">
                        <label for="chordInput">Chord Progression:</label>
                        <textarea id="chordInput" rows="15" style="resize: none;" placeholder="E(8) C#m(8) A(8) B(8)"></textarea>
                    </div>

                    <div id="scaleDegreeInputArea" style="display:none;">
                        <div class="key-selection-grid">
                            <div>
                                <label for="songKey">Song Key:</label>
                                <select id="songKey">
                                    <option value="C">C</option>
                                    <option value="C#">C# / Db</option>
                                    <option value="D">D</option>
                                    <option value="D#">D# / Eb</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                    <option value="F#">F# / Gb</option>
                                    <option value="G">G</option>
                                    <option value="G#">G# / Ab</option>
                                    <option value="A">A</option>
                                    <option value="A#">A# / Bb</option>
                                    <option value="B">B</option>
                                </select>
                            </div>
                            <div>
                                <label for="keyMode">Mode:</label>
                                <select id="keyMode">
                                    <option value="ionian" selected>Ionian (Major)</option>
                                    <option value="dorian">Dorian</option>
                                    <option value="phrygian">Phrygian</option>
                                    <option value="lydian">Lydian</option>
                                    <option value="mixolydian">Mixolydian</option>
                                    <option value="aeolian">Aeolian (Nat. Minor)</option>
                                    <option value="locrian">Locrian</option>
                                    <option value="harmonicMinor">Harmonic Minor</option>
                                    <option value="melodicMinor">Melodic Minor (Asc)</option>
                                </select>
                            </div>
                        </div>
                        <label for="scaleDegreeInput">Scale Degrees:</label>
                        <textarea id="scaleDegreeInput" rows="15" style="resize: none;" placeholder="I(2) V(2) vi(2) iii(2) IV(2) I(2) IV(2) V(2)"></textarea>
                    </div>
                </fieldset>
            </section>

            <section class="parameters-section">
                <fieldset id="parametersControlsFieldset">
                    <h2>‚öôÔ∏è Parameters</h2>
                    <div class="parameters-columns">
                        <div class="control-group timing-group">
                            <h3>‚è±Ô∏è Timing</h3>
                            <label for="bpm">BPM: <span id="bpmValue">120</span></label>
                            <input type="range" id="bpm" value="120" min="30" max="300" step="1">

                            <label for="timeSignature">Time Signature:</label>
                            <select id="timeSignature">
                                <option value="2/4">2/4</option>
                                <option value="3/4">3/4</option>
                                <option value="4/4" selected>4/4</option>
                                <option value="5/4">5/4</option>
                                <option value="6/8">6/8</option>
                                <option value="9/8">9/8</option>
                                <option value="12/8">12/8</option>
                            </select>
                        </div>

                        <div class="control-group synth-controls-group">
                            <h3>üéπ Synth</h3>
                            <div class="oscillator-control-inline">
                                <label for="oscillatorType">Oscillator:</label>
                                <select id="oscillatorType">
                                    <option value="sine">Sine</option>
                                    <option value="square">Square</option>
                                    <option value="sawtooth">Sawtooth</option>
                                    <option value="triangle" selected>Triangle</option>
                                </select>
                            </div>
                            
                            <div class="adsr-section">
                                <label class="section-sub-label">Envelope (ADSR) & Gain:</label>
                                <div class="adsr-canvas-container">
                                    <canvas id="adsrCanvas" width="200" height="100"></canvas>
                                </div>
                                <div class="adsr-knobs-container">
                                    <div class="knob-control">
                                        <label for="attack" class="knob-label-top">Attack</label>
                                        <input type="range" id="attack" class="adsr-knob" value="0.05" min="0.01" max="2" step="0.01" orient="vertical">
                                        <span id="attackValue" class="knob-value">0.05</span>
                                    </div>
                                    <div class="knob-control">
                                        <label for="decay" class="knob-label-top">Decay</label>
                                        <input type="range" id="decay" class="adsr-knob" value="0.1" min="0.01" max="2" step="0.01" orient="vertical">
                                        <span id="decayValue" class="knob-value">0.1</span>
                                    </div>
                                    <div class="knob-control">
                                        <label for="sustain" class="knob-label-top">Sustain</label>
                                        <input type="range" id="sustain" class="adsr-knob" value="0.7" min="0" max="1" step="0.01" orient="vertical">
                                        <span id="sustainValue" class="knob-value">0.7</span>
                                    </div>
                                    <div class="knob-control">
                                        <label for="release" class="knob-label-top">Release</label>
                                        <input type="range" id="release" class="adsr-knob" value="0.3" min="0.01" max="3" step="0.01" orient="vertical">
                                        <span id="releaseValue" class="knob-value">0.3</span>
                                    </div>
                                    <div class="knob-control">
                                        <label for="synthGain" class="knob-label-top">Gain</label>
                                        <input type="range" id="synthGain" class="adsr-knob" value="0.5" min="0" max="1" step="0.01" orient="vertical">
                                        <span id="synthGainValue" class="knob-value">0.5</span>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="control-group sound-options-group"> 
                            <h3>üîä Master & Metronome</h3>
                            <label for="masterGain">Master Gain: <span id="masterGainValue">0.5</span></label>
                            <input type="range" id="masterGain" value="0.5" min="0" max="1" step="0.01">
                            <label for="metronomeVolume">Metronome Vol Adj: <span id="metronomeVolumeValue">0.8</span></label>
                            <input type="range" id="metronomeVolume" value="0.8" min="0" max="1" step="0.01">
                        </div>

                        <div class="control-group voicing-pitch-range-group">
                            <h3>‚ÜîÔ∏è Pitch Range</h3>
                            <div>
                                <label for="rangeStartNoteSlider">Range Start: <span id="rangeStartNoteValue">C3</span></label>
                                <input type="range" id="rangeStartNoteSlider" value="48" min="36" max="72" step="1">
                            </div>
                            <div>
                                <label for="rangeLengthSlider">Range Length (semitones): <span id="rangeLengthValue">24</span></label>
                                <input type="range" id="rangeLengthSlider" value="24" min="12" max="24" step="1">
                            </div>
                            <div class="range-display">
                                Current Range: <span id="currentRangeDisplay">C3 - B4</span>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </section>
        </main>

        <section class="keyboard-section">
            <div id="pianoKeyboardContainer" class="piano-keyboard-container">
            </div>
        </section>

        <footer class="playback-footer">
            <div class="chord-context-display prev-chord">
                <div class="context-chord" id="prevChordDisplay">‚èÆÔ∏è Prev: --</div>
            </div>

            <div class="main-playback-wrapper">
                <div class="main-playback-controls">
                    <div class="playback-option-toggle button-style-toggle">
                        <input type="checkbox" id="loopToggle" name="loopToggle">
                        <label for="loopToggle" class="toggle-button">üîÅ Loop</label>
                    </div>
                    <button id="playStopButton">‚ñ∂Ô∏è Play</button>
                    <div class="playback-option-toggle button-style-toggle">
                        <input type="checkbox" id="metronomeAudioToggle" name="metronomeAudioToggle">
                        <label for="metronomeAudioToggle" class="toggle-button">ü•Å Metro</label>
                    </div>
                </div>

                <div class="main-playback-info">
                    <div id="currentChordDisplay">üé∂ Playing: --</div>
                    <div id="beatIndicatorContainer">
                    </div>
                </div>
            </div>

            <div class="chord-context-display next-chord">
                <div class="context-chord" id="nextChordDisplay">Next: ‚è≠Ô∏è --</div>
            </div>
        </footer>
    </div>

    <script type="module" src="main.js" defer></script>
</body>

</html>